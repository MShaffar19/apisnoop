<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Contributing to Kubernetes Conformance Coverage</title>
<meta name="author" content="ii.coop"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/reveal.css"/>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/theme/moon.css" id="theme"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/lib/css/zenburn.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">Contributing to Kubernetes Conformance Coverage</h1><h2 class="author">ii.coop</h2><p class="date">Created: 2020-10-23 Fri 18:18</p>
</section>

<section>
<section id="slide-orgb30ee0a">
<h2 id="orgb30ee0a">About ii</h2>
<p>
Coding Coop in New Zealand
</p>

<ul>
<li>Focus on Cooperative Coding</li>
<li>Pairing is Sharing</li>
<li>ii.coop</li>

</ul>

</section>
</section>
<section>
<section id="slide-org4b1f0c9">
<h3 id="org4b1f0c9">People</h3>
<ul>
<li>Hippie Hacker</li>
<li>Caleb Woodbine</li>
<li>Zach Mandeville</li>
<li>Stephen Heywood</li>
<li>Berno Kleinhans</li>
<li>Riaan Kleinhans</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgdda9993">
<h2 id="orgdda9993">INTRO</h2>
</section>
</section>
<section>
<section id="slide-org9e5950e">
<h3 id="org9e5950e">What is Kubernetes Conformance?</h3>
<p>
CNCF Kubernetes Conformance ensures
</p>

<blockquote>
<p>
&#x2026; that every vendorâ€™s version of Kubernetes supports the required APIs, as do open source community versions
</p>
</blockquote>

<aside class="notes">
<p>
It's good to have shared expectations of an API, regardless of who's hosting it for you.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org837c24b">
<h3 id="org837c24b">Conformance website</h3>
<p>
<a href="https://cncf.io/ck">https://cncf.io/ck</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-ck.png" alt="kubecon-2020-north-america-ck.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgd700b0f">
<h3 id="orgd700b0f">k8s-conformance repo</h3>
<p>
<a href="https://github.com/cncf/k8s-conformance">https://github.com/cncf/k8s-conformance</a>
</p>


<div id="orgb96c062" class="figure">
<p><img src="./kubecon-2020-north-america-conformance-repo.png" alt="kubecon-2020-north-america-conformance-repo.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgae42f41">
<h3 id="orgae42f41">Why is Kubernetes Conformance important?</h3>
<p>
Conformance with Kubernetes ensures:
</p>

<ul>
<li>portability of workloads
<ul>
<li>stable APIs behave the same everywhere</li>

</ul></li>
<li>freedom from vendor lock-in
<ul>
<li>consistency with APIs</li>

</ul></li>

</ul>

<aside class="notes">
<p>
I expectate my workloads to running anywhere k8s does, regardless of vendor.
</p>

</aside>

</section>
<section id="slide-org117a1a0">
<h4 id="org117a1a0">Who can meet your k8spectations?</h4>
<p>
Currently, there are ~67 certified distributions.
</p>

<p>
<a href="https://landscape.cncf.io/category=platform&amp;format=card-mode&amp;grouping=category">landscape.cncf.io</a>
</p>

<p>
Click <b>Certified K8s/KCSP/KTP</b> link on the left
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-landscape.png" alt="kubecon-2020-north-america-landscape.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgcc306e7">
<h2 id="orgcc306e7">How do I certify my k8s distribution?</h2>
<div class="outline-text-2" id="text-orgcc306e7">
</div>
</section>
<section id="slide-orgf7218ec">
<h4 id="orgf7218ec">Creating your Conformance Submission</h4>
<p>
<a href="https://github.com/cncf/k8s-conformance/blob/master/instructions.md">cncf/k8s-conformance /instructions.md</a>
</p>

<pre class="example">
vX.Y/$dir/README.md: how to reproduce your results.
vX.Y/$dir/e2e.log: Test log output (from Sonobuoy).
vX.Y/$dir/junit_01.xml: Machine-readable test log (from Sonobuoy).
vX.Y/$dir/PRODUCT.yaml: Details of your PRODUCT
</pre>

<aside class="notes">
<p>
Four files
</p>
<ul>
<li>docs to reproduce</li>
<li>product metadata</li>
<li>two types of logs</li>

</ul>

</aside>

</section>
<section id="slide-org33bf08e">
<h4 id="org33bf08e">Document How to Bring test your cluster</h4>
<p>
Example <b>README.md</b> with instructions:
</p>

<p>
<a href="https://github.com/cncf/k8s-conformance/tree/master/v1.18/kind">cncf/k8s-conformance/tree/master/v1.18/kind</a>
</p>

<div class="org-src-container">

<pre><code class=" tmate" >time ./kind-run.sh 1.18.0
</code></pre>
</div>

<aside class="notes">
<p>
run next two code block
</p>

</aside>

</section>
<section id="slide-org047dbf8">
<h4 id="org047dbf8">Sonobuoy Logs</h4>
<div class="org-src-container">

<pre><code class=" tmate" >sonobuoy logs -f
</code></pre>
</div>
</section>
<section id="slide-orgdf46363">
<h4 id="orgdf46363">Watch Sonobuoy</h4>
<div class="org-src-container">

<pre><code class=" tmate" >watch kubectl get all --all-namespaces
</code></pre>
</div>
</section>
<section id="slide-orgcfb8856">
<h4 id="orgcfb8856">Sonobuoy Results</h4>
<div class="org-src-container">

<pre><code class=" tmate" >find v1.*/plugins/e2e/results/global
</code></pre>
</div>

<pre class="example">
v1.18.0_2020-10-20_14:34.00/plugins/e2e/results/global
v1.18.0_2020-10-20_14:34.00/plugins/e2e/results/global/junit_01.xml
v1.18.0_2020-10-20_14:34.00/plugins/e2e/results/global/e2e.log
</pre>
</section>
<section id="slide-org2a90d8b">
<h4 id="org2a90d8b">Submit cncf/k8s-conformance results</h4>
<aside class="notes">
<p>
Run next code block
</p>

</aside>

<p>
<a href="https://github.com/cncf/k8s-conformance/blob/master/instructions.md#uploading">cncf/k8s-conformance instructions.md#uploading</a>
</p>

</section>
<section id="slide-org4198c1c">
<h4 id="org4198c1c">Fork+Branch+Remote</h4>
<div class="org-src-container">

<pre><code class=" tmate" >git clone https://github.com/cncf/k8s-conformance
cd k8s-conformance
git remote add ii git@github.com:ii/k8s-conformance
git checkout -b notkind-v1.18
</code></pre>
</div>
</section>
<section id="slide-orgd0afebc">
<h4 id="orgd0afebc">Copy results into place</h4>
<div class="org-src-container">

<pre><code class=" tmate" >cp -a ../notkind v1.18/notkind
cp -a ../v1.*/plugins/e2e/results/global/* v1.18/notkind
git status
</code></pre>
</div>
</section>
<section id="slide-orgc1f8054">
<h4 id="orgc1f8054">Commit and Push Results</h4>
<div class="org-src-container">

<pre><code class=" tmate" >git add v1.18/notkind
git commit -m 'Conformance results for v1.18/notkind'
git push ii notkind-v1.18
</code></pre>
</div>
</section>
<section id="slide-orgb01cc24">
<h4 id="orgb01cc24">Open a PR to cncf/k8s-conformance</h4>
<p>
<a href="https://github.com/cncf/k8s-conformance/compare/master...ii:notkind-v1.18-test">cncf/k8s-conformance/compare/master&#x2026;your:branch</a>
</p>
</section>
<section id="slide-org460d019">
<h4 id="org460d019">Contents of the PR</h4>
<div class="org-src-container">

<pre><code class=" bash" >git diff --name-only origin/master
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" bash" >v1.18/notkind/PRODUCT.yaml
v1.18/notkind/README.md
v1.18/notkind/e2e.log
v1.18/notkind/junit_01.xml
</code></pre>
</div>

<aside class="notes">
<p>
This will allow the CNCF and the community to verify
your submission includes all the test results and metadata
required for conformance.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org06fcdba">
<h2 id="org06fcdba">DEEP DIVE</h2>
<p>
Gaps in Kubernetes Conformance Coverage
</p>

<ul>
<li>Identify</li>
<li>Close</li>
<li>Prevent</li>

</ul>

<aside class="notes">
<p>
switch obs scene to INTRO
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org5623646">
<h2 id="org5623646">Identifying Gaps in Kubernetes Conformance Coverage</h2>
<div class="outline-text-2" id="text-org5623646">
</div>
</section>
</section>
<section>
<section id="slide-orgc616931">
<h3 id="orgc616931"><a href="https://apisnoop.cncf.io">https://apisnoop.cncf.io</a></h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-sunburst.png" alt="kubecon-2020-north-america-sunburst.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org374e126">
<h3 id="org374e126">snoopDB</h3>
<p>
<a href="https://github.com/cncf/apisnoop/blob/master/apps/snoopdb/tables-views-functions.org#basic-database-setup">Database Setup</a> Schemas:
</p>
<dl>
<dt>public</dt><dd>from k/k <a href="https://github.com/kubernetes/kubernetes/tree/master/api/openapi-spec">swagger.json</a></dd>
<dt>conformance</dt><dd>CI job <a href="https://gcsweb.k8s.io/gcs/kubernetes-jenkins/logs/ci-kubernetes-gce-conformance-latest/1319331777721929728/artifacts/bootstrap-e2e-master/">api-audit.logs</a></dd>
<dt>testing</dt><dd>from live in-cluster usage</dd>

</dl>

<aside class="notes">
<p>
How can I deploy snoopdb in my cluster and ask my own questions about the API shape and usage?
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org4a10f6d">
<h3 id="org4a10f6d">How can I deploy snoopdb?</h3>
<p>
<b>MANY</b> ways to deploy, one <code>kind</code> way:
</p>

<div class="org-src-container">

<pre><code class=" bash" >git clone https://github.com/cncf/apisnoop
cd apisnoop/kind
kind create cluster --config=kind+apisnoop.yaml
kubectl wait --for=condition=Ready --timeout=600s \
  --selector=app.kubernetes.io/name=auditlogger pod
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org5b3fdd3">
<h3 id="org5b3fdd3">Schemas</h3>
<pre class="example">
    Name     |  Size   |                       Description
-------------+---------+----------------------------------------------------------
 audit_event | 884 MB  | every event from an e2e test run, or multiple test runs.
 open_api    | 5080 kB | endpoint details from openAPI spec
</pre>
</section>
</section>
<section>
<section id="slide-orgcedb3c7">
<h3 id="orgcedb3c7">Loading K8s API into SQL</h3>
<dl>
<dt>SnoopDB</dt><dd><a href="https://github.com/cncf/apisnoop/blob/master/apps/snoopdb/postgres/snoopUtils.py#L290-L292">loads the OpenAPI swagger.json</a></dd>

</dl>
<div class="org-src-container">

<pre><code class=" python" >swagger_url = K8S_GITHUB_REPO + commit_hash + \
  '/api/openapi-spec/swagger.json'
openapi_spec = load_openapi_spec(swagger_url)
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-orgead2aa3">
<h3 id="orgead2aa3">OpenAPI Table</h3>
<dl>
<dt>K8s API definition</dt><dd>shape of API</dd>

</dl>

<div class="org-src-container">

<pre><code class=" sql-mode" >\d open_api ; describe table
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" >    Column    |            Type             |
--------------+-----------------------------+
 release      | text                        |
 release_date | timestamp without time zone |
 endpoint     | text                        |
 level        | text                        |
 category     | text                        |
 path         | text                        |
 k8s_group    | text                        |
 k8s_version  | text                        |
 k8s_kind     | text                        |
 k8s_action   | text                        |
 deprecated   | boolean                     |
 description  | text                        |
 spec         | text                        |
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgd41e761">
<h3 id="orgd41e761">PSQL Example Query</h3>
<p>
Newly Stable Endpoints
</p>

<div class="org-src-container">

<pre><code class=" bash" >export PGUSER=apisnoop PGHOST=localhost
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" bash" >psql -c "with endpoint_and_first_release as (
 select endpoint, level,
 (array_agg(release order by release::semver))[1]
    as first_release
  from open_api group by level, endpoint)
select level, endpoint, first_release
  from endpoint_and_first_release
 where first_release = '1.20.0' and level='stable';"
</code></pre>
</div>

<pre class="example">
 level  |           endpoint           | first_release
--------+------------------------------+---------------
 stable | getInternalApiserverAPIGroup | 1.20.0
(1 row)

</pre>

</section>
</section>
<section>
<section id="slide-org70ae049">
<h3 id="org70ae049">Audit CI logs in a DB</h3>
<ul>
<li>SnoopDB loads recent CI audit logs</li>
<li>Query Test Job K8s API Usage</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgf202ec0">
<h3 id="orgf202ec0">kind-conformance-audit job</h3>
<p>
<a href="https://testgrid.k8s.io/sig-arch-conformance#kind-conformance-audit">testgrid.k8s.io/sig-arch-conformance#kind-conformance-audit</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-kind-audit-job.png" alt="kubecon-2020-north-america-kind-audit-job.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orge778fad">
<h3 id="orge778fad">AuditEvent Table</h3>
<dl>
<dt>K8s API definition</dt><dd>shape of API</dd>

</dl>

<div class="org-src-container">

<pre><code class=" sql-mode" >\d audit_event ; describe table
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" >    Column     |            Type             |
---------------+-----------------------------+
 release       | text                        |
 release_date  | text                        |
 audit_id      | text                        |
 endpoint      | text                        |
 useragent     | text                        |
 test          | text                        |
 test_hit      | boolean                     |
 conf_test_hit | boolean                     |
 data          | jsonb                       |
 source        | text                        |
 id            | integer                     |
 ingested_at   | timestamp without time zone |
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orga4df13d">
<h3 id="orga4df13d">Prow Job Audit Logs</h3>
<p>
By default we load recent conformance prow jobs
</p>

<div class="org-src-container">

<pre><code class=" sql-mode" >select distinct release,
                split_part(source,'/',8) as "prow-job"
  from audit_event
 where source like 'https://prow.k8s.io%';
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" > release |               prow-job
---------+--------------------------------------
 1.20.0  | ci-kubernetes-gce-conformance-latest
 1.20.0  | ci-kubernetes-e2e-gci-gce
(2 rows)

</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgaea412b">
<h3 id="orgaea412b">e2e.test framework support</h3>
<ul>
<li>UserAgent updated to include test name</li>
<li>AuditLogs include test and operation</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgabe39c7">
<h3 id="orgabe39c7">Conformance Tests</h3>
<div class="org-src-container">

<pre><code class=" sql-mode" >select distinct test
  from audit_event
  where test ilike '%Conformance%'
  limit 5
  ;
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" >                                                                                 test
----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 [sig-storage] Projected secret should be able to mount in a volume regardless of a different secret existing with same name in different namespace [NodeConformance]
 [sig-storage] Subpath Atomic writer volumes should support subpaths with configmap pod [LinuxOnly] [Conformance]
 [sig-network] Services should provide secure master service  [Conformance]
 [sig-network] Networking Granular Checks: Pods should function for intra-pod communication: udp [NodeConformance] [Conformance]
 [sig-api-machinery] Secrets should fail to create secret due to empty secret key [Conformance]
(5 rows)

</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org4178756">
<h3 id="org4178756">New Endpoints in 1.20</h3>
<p>
<a href="https://apisnoop.cncf.io">https://apisnoop.cncf.io</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-newendpoints.png" alt="kubecon-2020-north-america-newendpoints.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgc1311bd">
<h3 id="orgc1311bd">Coverage at Time of Release</h3>
<p>
<a href="https://apisnoop.cncf.io/conformance-progress">https://apisnoop.cncf.io/conformance-progress</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-release-coverage.png" alt="kubecon-2020-north-america-release-coverage.png" />
</p>
</div>

<aside class="notes">
<p>
This graph shows about 3 years of work.
The conformance program was initiated during 1.9 and ii started writing tests at around 1.15.
We color in the grey with red, to fill in the debt (aka gaps) in coverage.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgd0a50cf">
<h3 id="orgd0a50cf">Current Conformance Debt</h3>
<p>
<a href="https://apisnoop.cncf.io/conformance-progress">https://apisnoop.cncf.io/conformance-progress</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-current-debt.png" alt="kubecon-2020-north-america-current-debt.png" />
</p>
</div>
<aside class="notes">
<p>
The current conformance debt shows how old our debt is, and how much remains.
We hope to clear all debt back to 1.11 by the time we cut the 1.20 release.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-org1e9d5eb">
<h2 id="org1e9d5eb">Closing gaps in Kubernetes Conformance Coverage</h2>
<div class="outline-text-2" id="text-org1e9d5eb">
</div>
</section>
</section>
<section>
<section id="slide-org0ab6bf5">
<h3 id="org0ab6bf5">Identifying an untested features</h3>
<div class="org-src-container">

<pre><code class=" id="untested_stable_core_endpoints" sql-mode" >SELECT
  endpoint,
  -- k8s_action,
  -- path,
  -- description,
  kind
  FROM testing.untested_stable_endpoint
  where eligible is true
  and category = 'core'
  order by kind, endpoint desc
  limit 5;
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" >             endpoint             |  kind
----------------------------------+---------
 createCoreV1NamespacedPodBinding | Binding
 createCoreV1NamespacedBinding    | Binding
 replaceCoreV1NamespacedEvent     | Event
 readCoreV1NamespacedEvent        | Event
 patchCoreV1NamespacedEvent       | Event
(5 rows)

</code></pre>
</div>
<aside class="notes">
<p>
We start with a query to focus on specific untested endpoints.
Here we search for the first 5 stable/core endpoints, which are eligible for conformance, but lack tests.
</p>

</aside>
</section>
</section>
<section>
<section id="slide-orgb80eb19">
<h3 id="orgb80eb19">Discover docs on target endpoints</h3>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes API Reference Docs</a></li>
<li><p>
<a href="https://github.com/kubernetes/client-go/blob/master/kubernetes/typed">client-go - corev1</a>
</p>

<aside class="notes">
<p>
Got endpoint, go to reference docs, thank sig-docs.
Understand how to talk to the resource in the client-go corev1 folder.
</p>

</aside></li>

</ul>

</section>
</section>
<section>
<section id="slide-org7c794d9">
<h3 id="org7c794d9">Describe the outline</h3>
<p>
To test through the lifecycle of a resource:
</p>

<ol>
<li>Create a RESOURCENAME</li>

<li>Patch the RESOURCENAME</li>

<li>Get the RESOURCENAME</li>

<li>List all RESOURCENAMEs</li>

<li>Delete RESOURCENAME</li>

</ol>

<aside class="notes">
<p>
Here's an outline of the test we will write.
It's often the lifecycle of the resource.
</p>

<p>
Hippie Interupts: This allows discussion of the approach without needing to have a fully fleshed out test yet.
</p>

</aside>

</section>
</section>
<section>
<section id="slide-org1a57305">
<h3 id="org1a57305">Write a mock test</h3>
<p>
Prove coverage change by exercising the endpoints:
</p>

<div class="org-src-container">

<pre><code class=" id="small snippet" go" >fmt.Println("creating a Pod")

// ... declare the test pod resource

_, err = ClientSet
           .CoreV1().Pods(testNamespaceName)
           .Create(context.TODO(),
                   &amp;testPod,
                   metav1.CreateOptions{})
if err != nil {
    fmt.Println(err, "failed to create Pod")
    return
}
</code></pre>
</div>

<aside class="notes">
<p>
At this point we don't yet use the e2e test suite, as this code is exported into our tickets before writing a PR.
</p>

</aside>

</section>
</section>
<section>
<section id="slide-org4626030">
<h3 id="org4626030">Validate the coverage change</h3>
<p>
List endpoints hit by the test:
</p>
<div class="org-src-container">

<pre><code class=" sql-mode" >select * from testing.endpoint_hit_by_new_test;
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" >     useragent     |           endpoint            | hit_by_ete | hit_by_new_test
-------------------+-------------------------------+------------+-----------------
 live-test-writing | createCoreV1NamespacedPod     | t          |               4
 live-test-writing | deleteCoreV1NamespacedPod     | t          |               4
 live-test-writing | listCoreV1PodForAllNamespaces | t          |               4
(3 rows)

</code></pre>
</div>

<aside class="notes">
<p>
We run the mock-test in cluster, and set the useragent to 'live-test-writing'
which allows us to see what new/untested endpoints are hit by our test-to-be.
</p>

</aside>

</section>
</section>
<section>
<section id="slide-orgd5b24fd">
<h3 id="orgd5b24fd">Display endpoint coverage change</h3>
<div class="org-src-container">

<pre><code class=" sql-mode" >select change_in_number
from testing.projected_change_in_coverage;
</code></pre>
</div>

<div class="org-src-container">

<pre><code class=" example" > change_in_number
------------------
                0
(1 row)

</code></pre>
</div>

<aside class="notes">
<p>
This test wasn't effective enough.
</p>

<p>
Pods are already covered in conformance.
</p>

</aside>

</section>
</section>
<section>
<section id="slide-org4a7f210">
<h3 id="org4a7f210">Submitting a mock ticket</h3>
<ul>
<li>exported as Markdown</li>
<li>submitted as GitHub issues.</li>

</ul>

<div class="figure">
<p><img src="./kubecon-2020-north-america-board.png" alt="kubecon-2020-north-america-board.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org5ead331">
<h2 id="org5ead331">Preventing gaps in Kubernetes Conformance Coverage</h2>
<div class="outline-text-2" id="text-org5ead331">
</div>
</section>
</section>
<section>
<section id="slide-org309649a">
<h3 id="org309649a">testgrid.k8s.io</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-testgrid.png" alt="kubecon-2020-north-america-testgrid.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgf56633b">
<h3 id="orgf56633b">sig-arch / conformance prow jobs</h3>
<p>
<a href="https://github.com/kubernetes/test-infra/tree/master/config/jobs/kubernetes/sig-arch">kubernetes/test-infra config/jobs/kubernetes/sig-arch</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-prow-jobs.png" alt="kubecon-2020-north-america-prow-jobs.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org4d6d3ed">
<h3 id="org4d6d3ed">apisnoop-conformance-gate</h3>
<p>
<a href="https://github.com/kubernetes/test-infra/blob/master/config/jobs/kubernetes/sig-arch/conformance-gate.yaml">Eventually Release Blocking Conformance Job</a>
</p>


<div class="figure">
<p><img src="./kubecon-2020-north-america-blocking-job.png" alt="kubecon-2020-north-america-blocking-job.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgf8be513">
<h3 id="orgf8be513">Job Fails and Emails</h3>
<p>
Any new gaps in coverage are detected
</p>

<div class="org-src-container">

<pre><code class=" yaml" >name: apisnoop-conformance-gate
annotations:
  testgrid-dashboards: sig-arch-conformance
  testgrid-tab-name: apisnoop-conformance-gate
  test-grid-alert-email: kubernetes-sig-arch-conformance-test-failures@googlegroups.com
  testgrid-num-failures-to-alert: '1'
  description: 'Uses APISnoop to check that new GA endpoints are conformance tested in latest e2e test run'
</code></pre>
</div>

<aside class="notes">
<p>
This job will help us notify sig-release that there is a new API that must have Conformance Tests OR be reverted before a release can happen.
</p>

</aside>

</section>
</section>
<section>
<section id="slide-org340322e">
<h2 id="org340322e">DEEP DIVE Summary</h2>
<p>
Gaps in Kubernetes Conformance Coverage
</p>

<dl>
<dt>Identify</dt><dd>using apisnoop.cncf.io + snoopdb</dd>
<dt>Close</dt><dd>using humacs in-cluster workflow</dd>
<dt>Prevent</dt><dd>release blocking jobs</dd>

</dl>
</section>
</section>
<section>
<section id="slide-orgc52d484">
<h2 id="orgc52d484">Verifying Conformance Submissons</h2>
<p>
prow.cncf.io
</p>

<p>
Remember our PR submission from earlier?
</p>

</section>
</section>
<section>
<section id="slide-orgcd7fd12">
<h3 id="orgcd7fd12">Results submitted</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-pr-page.png" alt="kubecon-2020-north-america-pr-page.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgd0a82a7">
<h3 id="orgd0a82a7">CNCF CI comments</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-prow-comments.png" alt="kubecon-2020-north-america-prow-comments.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org1b17220">
<h3 id="org1b17220">Informational labels</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-pr-labels.png" alt="kubecon-2020-north-america-pr-labels.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgfb55fc4">
<h3 id="orgfb55fc4">Certified distributions</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-certified-distributions.png" alt="kubecon-2020-north-america-certified-distributions.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgfa4f747">
<h3 id="orgfa4f747">Certified Logo (tm)</h3>

<div class="figure">
<p><img src="./kubecon-2020-north-america-certified-logo.png" alt="kubecon-2020-north-america-certified-logo.png" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgd85f63d">
<h2 id="orgd85f63d">Q&amp;A</h2>
<ul>
<li><a href="https://cncf.io/ck">https://cncf.io/ck</a></li>
<li><a href="https://apisnoop.cncf.io">https://apisnoop.cncf.io</a></li>
<li><a href="https://testgrid.k8s.io">https://testgrid.k8s.io</a></li>
<li><a href="https://github.com/cncf/k8s-conformance">https://github.com/cncf/k8s-conformance</a></li>
<li><a href="https://github.com/cncf/apisnoop">https://github.com/cncf/apisnoop</a></li>

</ul>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/lib/js/head.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,

overview: true,
margin: 0.10,
minScale: 0.20,
maxScale: 3.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'cube', // see README of reveal.js for options
transitionSpeed: '1',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: 'https://reveal-js-multiplex-ccjbegmaii.now.sh' // Location of socket.io server
},

// Optional libraries used to extend reveal.js
dependencies: [
 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: 'https://cdn.socket.io/socket.io-1.3.5.js', async: true },
 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/multiplex/master.js', async: true }]

});
</script>
</body>
</html>
